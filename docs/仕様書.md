# 物流品質トラブル管理システム 仕様書

## 文書情報

| 項目 | 内容 |
|------|------|
| 文書名 | 物流品質トラブル管理システム 仕様書 |
| バージョン | 2.0 |
| 作成日 | 2025年10月3日 |
| 最終更新日 | 2025年10月3日 |
| 作成者 | システム開発チーム |

---

## 目次

1. [システム概要](#1-システム概要)
2. [機能要件](#2-機能要件)
3. [非機能要件](#3-非機能要件)
4. [データモデル](#4-データモデル)
5. [API仕様](#5-api仕様)
6. [UI/UX仕様](#6-uiux仕様)
7. [技術仕様](#7-技術仕様)
8. [運用・保守要件](#8-運用保守要件)
9. [セキュリティ要件](#9-セキュリティ要件)
10. [制約事項](#10-制約事項)

---

## 1. システム概要

### 1.1 システム名
物流品質トラブル管理システム（Logistics Trouble Management System）

### 1.2 システムの目的
物流業務における品質トラブルの発生から解決までを効率的に管理し、トラブルの分析・改善・再発防止を支援するシステムです。

### 1.3 対象ユーザー
- 物流品質管理担当者
- 倉庫管理者
- 配送管理者
- 品質改善担当者

### 1.4 システムの特徴
- 3段階の情報管理（1次情報→2次情報→3次情報）
- リアルタイムダッシュボード
- 包括的なレポート機能

---

## 2. 機能要件

### 2.1 インシデント管理機能

#### 2.1.1 インシデント登録
- **機能**: 物流トラブルの新規登録
- **入力項目**:
  - 基本情報（作成日、所属組織、作成者）
  - 発生情報（発生日時、発生場所、出荷元倉庫）
  - トラブル情報（区分、詳細区分、内容詳細）
  - 関連情報（伝票番号、得意先コード、商品コード、数量、単位）

#### 2.1.2 インシデント編集・更新
- **機能**: 登録済みインシデントの編集・更新
- **制約**: ステータスに応じた編集権限管理
- **バージョン管理**: 変更履歴の保持

#### 2.1.3 インシデント検索・フィルタリング
- **機能**: インシデントの検索・絞り込み
- **検索条件**:
  - キーワード検索（全項目対象）
  - 期間指定（年・月）
  - 出荷元倉庫
  - ステータス
  - トラブル区分

### 2.2 3段階情報管理機能

#### 2.2.1 1次情報管理
- **目的**: 初期報告・基本情報の収集
- **入力期限**: 発生から即座
- **ステータス**: 2次情報調査中

#### 2.2.2 2次情報管理
- **目的**: 詳細調査・原因分析
- **入力期限**: 1次情報登録から7日以内
- **入力項目**:
  - 発生経緯
  - 発生原因
  - 写真データ
- **ステータス**: 3次情報調査中

#### 2.2.3 3次情報管理
- **目的**: 再発防止策の策定
- **入力期限**: 2次情報登録から7日以内
- **入力項目**:
  - 再発防止策
- **ステータス**: 完了

### 2.3 ダッシュボード機能

#### 2.3.1 統計情報表示
- **KPI表示**:
  - トラブル総件数
  - 完了件数
  - 進捗率
  - 2次情報遅延件数
  - 3次情報遅延件数

#### 2.3.2 グラフ・チャート表示
- **日別発生件数**: 棒グラフ
- **出荷元倉庫別**: 円グラフ
- **トラブル区分別**: 円グラフ
- **トラブル詳細区分別**: 円グラフ
- **運送会社別**: 円グラフ
- **ステータス別**: 円グラフ

### 2.4 レポート機能

#### 2.4.1 CSV出力
- **機能**: インシデント一覧のCSV出力
- **出力項目**: 全項目（写真データ除く）
- **ファイル名**: 物流品質トラブル一覧_YYYYMMDD.csv

### 2.5 通知機能

#### 2.5.1 遅延アラート
- **機能**: 入力期限超過の自動検知
- **対象**: 2次情報・3次情報の遅延
- **表示**: ダッシュボードでの警告表示

---

## 3. 非機能要件

### 3.1 性能要件

#### 3.1.1 レスポンス時間
- **画面表示**: 3秒以内
- **検索処理**: 5秒以内
- **CSV出力**: 10秒以内

#### 3.1.2 スループット
- **同時接続ユーザー**: 100ユーザー
- **1日の処理件数**: 1,000件

#### 3.1.3 データ容量
- **インシデント件数**: 10,000件/年
- **画像データ**: 5MB/件

### 3.2 可用性要件

#### 3.2.1 稼働率
- **目標稼働率**: 99.5%
- **計画停止時間**: 月4時間以内

#### 3.2.2 バックアップ
- **データバックアップ**: 日次
- **復旧時間**: 4時間以内

### 3.3 拡張性要件

#### 3.3.1 スケーラビリティ
- **水平スケーリング**: 対応
- **垂直スケーリング**: 対応

#### 3.3.2 機能拡張
- **新機能追加**: 容易
- **既存機能変更**: 影響最小化

---

## 4. データモデル

### 4.1 インシデント（Incident）

```typescript
type Incident = {
  id: string;                    // インシデントID
  // 1次情報
  creationDate: string;          // 作成日 (YYYY-MM-DD)
  organization: string;          // 所属組織
  creator: string;               // 作成者
  occurrenceDateTime: string;    // 発生日時 (YYYY-MM-DDTHH:mm)
  occurrenceLocation: string;    // 発生場所
  shippingWarehouse: string;     // 出荷元倉庫
  shippingCompany: string;       // 運送会社名
  troubleCategory: string;       // トラブル区分
  troubleDetailCategory: string; // トラブル詳細区分
  details: string;               // 内容詳細
  voucherNumber?: string;        // 伝票番号
  customerCode?: string;         // 得意先コード
  productCode?: string;          // 商品コード
  quantity?: number;             // 数量
  unit?: string;                 // 単位

  // 2次情報
  inputDate?: string;            // 入力日 (YYYY-MM-DD)
  processDescription?: string;   // 発生経緯
  cause?: string;                // 発生原因
  photoDataUri?: string;         // 写真データURI

  // 3次情報
  inputDate3?: string;           // 入力日 (YYYY-MM-DD)
  recurrencePreventionMeasures?: string; // 再発防止策
  
  // その他
  status: string;                // ステータス
  infoInputDates?: {             // 各段階の入力日
    info1?: string;              // 1次情報入力日
    info2?: string;              // 2次情報入力日
    info3?: string;              // 3次情報入力日
  }
};
```

### 4.2 ステータス定義

| ステータス | 説明 | 遷移条件 |
|------------|------|----------|
| 2次情報調査中 | 1次情報登録後、2次情報入力待ち | 1次情報登録時 |
| 2次情報遅延 | 2次情報入力期限超過 | 7日経過後 |
| 3次情報調査中 | 2次情報登録後、3次情報入力待ち | 2次情報登録時 |
| 3次情報遅延 | 3次情報入力期限超過 | 7日経過後 |
| 完了 | 全段階完了 | 3次情報登録時 |

### 4.3 マスタデータ

#### 4.3.1 組織
- 本社A
- 本社B
- 東日本
- 西日本

#### 4.3.2 発生場所
- 倉庫（入荷作業）
- 倉庫（格納作業）
- 倉庫（出荷作業）
- 配送（集荷/配達）
- 配送（施設内）
- お客様先

#### 4.3.3 出荷元倉庫
- 札幌倉庫
- 東京倉庫
- 埼玉倉庫
- 横浜倉庫
- 大阪倉庫
- 神戸倉庫
- 松山倉庫

#### 4.3.4 運送会社
- ヤマト運輸
- 佐川急便
- 福山通運
- 西濃運輸
- チャーター
- その他輸送会社

#### 4.3.5 トラブル区分
- 荷役トラブル
- 配送トラブル

#### 4.3.6 トラブル詳細区分
- 商品間違い
- 数量過不足
- 送付先間違い
- 発送漏れ
- 破損・汚損
- 紛失
- その他の商品事故

---

## 5. API仕様

### 5.1 データ管理API（将来実装予定）

#### 5.1.1 インシデント取得
```typescript
// エンドポイント
GET /api/incidents

// クエリパラメータ
{
  page?: number;        // ページ番号
  limit?: number;       // 1ページあたりの件数
  search?: string;      // 検索キーワード
  year?: number;        // 年
  month?: number;       // 月
  warehouse?: string;   // 出荷元倉庫
  status?: string;      // ステータス
}

// レスポンス
{
  incidents: Incident[];
  total: number;
  page: number;
  limit: number;
}
```

#### 5.1.2 インシデント作成・更新
```typescript
// エンドポイント
POST /api/incidents
PUT /api/incidents/:id

// リクエスト
Incident

// レスポンス
{
  success: boolean;
  incident: Incident;
}
```

---

## 6. UI/UX仕様

### 6.1 デザインシステム

#### 6.1.1 カラーパレット
- **プライマリ**: #3B82F6 (青)
- **セカンダリ**: #6B7280 (グレー)
- **成功**: #10B981 (緑)
- **警告**: #F59E0B (オレンジ)
- **エラー**: #EF4444 (赤)

#### 6.1.2 タイポグラフィ
- **フォント**: Inter, Noto Sans JP
- **見出し**: 700 weight
- **本文**: 400 weight
- **キャプション**: 500 weight

#### 6.1.3 スペーシング
- **基本単位**: 4px
- **コンポーネント間**: 16px
- **セクション間**: 24px

### 6.2 レスポンシブデザイン

#### 6.2.1 ブレークポイント
- **モバイル**: < 768px
- **タブレット**: 768px - 1024px
- **デスクトップ**: > 1024px

#### 6.2.2 レイアウト
- **モバイル**: 1カラム
- **タブレット**: 2カラム
- **デスクトップ**: 3カラム

### 6.3 アクセシビリティ

#### 6.3.1 WCAG準拠
- **レベル**: AA準拠
- **コントラスト比**: 4.5:1以上
- **キーボード操作**: 完全対応

#### 6.3.2 多言語対応
- **対応言語**: 日本語
- **文字エンコーディング**: UTF-8

---

## 7. 技術仕様

### 7.1 フロントエンド

#### 7.1.1 フレームワーク
- **Next.js**: 14.x (App Router)
- **React**: 18.x
- **TypeScript**: 5.x

#### 7.1.2 UIライブラリ
- **Tailwind CSS**: 3.x
- **shadcn/ui**: 最新版
- **Lucide React**: アイコン

#### 7.1.3 状態管理
- **React Hooks**: useState, useEffect, useMemo
- **React Hook Form**: フォーム管理
- **Zod**: バリデーション

#### 7.1.4 チャート・グラフ
- **Recharts**: データ可視化

### 7.2 バックエンド（将来実装予定）

#### 7.2.1 フレームワーク
- **Next.js API Routes**: サーバーサイド
- **Node.js**: 18.x

#### 7.2.2 データベース
- **PostgreSQL**: メインDB
- **Redis**: キャッシュ・セッション

#### 7.2.3 認証
- **NextAuth.js**: 認証フレームワーク

### 7.3 開発・運用ツール

#### 7.3.1 開発環境
- **Node.js**: 18.x
- **npm/yarn**: パッケージ管理
- **ESLint**: コード品質
- **Prettier**: コードフォーマット

#### 7.3.2 テスト
- **Jest**: 単体テスト
- **React Testing Library**: コンポーネントテスト
- **Playwright**: E2Eテスト

#### 7.3.3 CI/CD
- **GitHub Actions**: 自動化
- **Vercel**: デプロイメント

---

## 8. 運用・保守要件

### 8.1 監視・ログ

#### 8.1.1 アプリケーション監視
- **エラー監視**: Sentry
- **パフォーマンス監視**: Vercel Analytics
- **ユーザー行動分析**: Google Analytics

#### 8.1.2 ログ管理
- **アプリケーションログ**: 構造化ログ
- **アクセスログ**: Webサーバーログ
- **エラーログ**: エラー詳細情報

### 8.2 バックアップ・復旧

#### 8.2.1 データバックアップ
- **頻度**: 日次
- **保持期間**: 30日
- **保存場所**: クラウドストレージ

#### 8.2.2 災害復旧
- **RTO**: 4時間
- **RPO**: 1時間
- **復旧手順**: 文書化済み

### 8.3 セキュリティ

#### 8.3.1 データ保護
- **暗号化**: TLS 1.3
- **データマスキング**: 個人情報保護
- **アクセス制御**: ロールベース

#### 8.3.2 脆弱性管理
- **定期スキャン**: 月次
- **パッチ管理**: 自動更新
- **セキュリティ監査**: 年次

---

## 9. セキュリティ要件

### 9.1 認証・認可

#### 9.1.1 認証方式
- **多要素認証**: 対応
- **セッション管理**: 安全な実装
- **パスワードポリシー**: 強固な設定

#### 9.1.2 認可
- **ロールベースアクセス制御**: 実装
- **最小権限の原則**: 適用
- **API認証**: JWT使用

### 9.2 データセキュリティ

#### 9.2.1 暗号化
- **転送時**: TLS 1.3
- **保存時**: AES-256
- **キー管理**: 安全な実装

#### 9.2.2 データ保護
- **個人情報**: 適切な保護
- **機密情報**: アクセス制限
- **監査ログ**: 完全な記録

### 9.3 セキュリティ監視

#### 9.3.1 侵入検知
- **リアルタイム監視**: 24/7
- **異常検知**: 自動アラート
- **インシデント対応**: 迅速な対応

---

## 10. 制約事項

### 10.1 技術的制約

#### 10.1.1 ブラウザ対応
- **Chrome**: 最新版
- **Firefox**: 最新版
- **Safari**: 最新版
- **Edge**: 最新版

#### 10.1.2 デバイス制約
- **モバイル**: iOS 14+, Android 8+
- **タブレット**: iPad OS 14+, Android 8+
- **デスクトップ**: Windows 10+, macOS 10.15+

### 10.2 業務制約

#### 10.2.1 データ保持期間
- **インシデントデータ**: 3年
- **ログデータ**: 1年
- **バックアップデータ**: 30日

#### 10.2.2 利用時間
- **営業時間**: 24時間365日
- **メンテナンス**: 月次（4時間以内）

### 10.3 法的制約

#### 10.3.1 個人情報保護
- **個人情報保護法**: 準拠
- **GDPR**: 準拠（該当する場合）

#### 10.3.2 業界規制
- **物流業界基準**: 準拠
- **品質管理基準**: ISO 9001準拠

---

## 付録

### A. 用語集

| 用語 | 説明 |
|------|------|
| インシデント | 物流業務で発生した品質トラブル |
| 1次情報 | 初期報告・基本情報 |
| 2次情報 | 詳細調査・原因分析情報 |
| 3次情報 | 再発防止策情報 |
| KPI | Key Performance Indicator（重要業績評価指標） |
| RTO | Recovery Time Objective（復旧時間目標） |
| RPO | Recovery Point Objective（復旧ポイント目標） |

### B. 参考資料

- [Next.js公式ドキュメント](https://nextjs.org/docs)
- [React公式ドキュメント](https://react.dev/)
- [Tailwind CSS公式ドキュメント](https://tailwindcss.com/docs)
- [shadcn/ui公式ドキュメント](https://ui.shadcn.com/)

---

**文書の終わり**
